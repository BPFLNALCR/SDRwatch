<div class="space-y-6">
  <form id="dashboard-filter" class="card space-y-4" method="get" hx-get="/" hx-target="#dashboard-shell" hx-trigger="change delay:400ms, submit" hx-push-url="true" hx-indicator="#dashboard-loading">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-3">
      <div class="field">
        <label for="filter-service">Service</label>
        <select id="filter-service" name="service" class="input">
          <option value="">Any</option>
          {% for svc in services %}
            <option value="{{ svc }}" {% if form_defaults.service == svc %}selected{% endif %}>{{ svc }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="field">
        <label for="filter-min-snr">Min SNR (dB)</label>
        <input id="filter-min-snr" class="input" type="number" step="0.1" name="min_snr" value="{{ form_defaults.min_snr }}" placeholder="e.g. 10" />
      </div>
      <div class="field">
        <label for="filter-fmin">Min freq (MHz)</label>
        <input id="filter-fmin" class="input" type="number" step="0.1" name="f_min_mhz" value="{{ form_defaults.f_min_mhz }}" placeholder="Start" />
      </div>
      <div class="field">
        <label for="filter-fmax">Max freq (MHz)</label>
        <input id="filter-fmax" class="input" type="number" step="0.1" name="f_max_mhz" value="{{ form_defaults.f_max_mhz }}" placeholder="Stop" />
      </div>
      <div class="field">
        <label for="filter-since">Lookback (hours)</label>
        <input id="filter-since" class="input" type="number" step="1" min="1" name="since_hours" value="{{ form_defaults.since_hours }}" placeholder="168" />
      </div>
      <div class="field">
        <label for="filter-snr-bucket">SNR bucket (dB)</label>
        <input id="filter-snr-bucket" class="input" type="number" step="1" min="1" name="snr_bucket_db" value="{{ snr_bucket_db }}" />
      </div>
      <div class="field">
        <label for="filter-heatmap-scans">Heatmap scans</label>
        <input id="filter-heatmap-scans" class="input" type="number" step="1" min="5" name="heatmap_scans" value="{{ heatmap_settings.scans }}" />
      </div>
      <div class="field">
        <label for="filter-heatmap-bins">Heatmap bins</label>
        <input id="filter-heatmap-bins" class="input" type="number" step="1" min="12" name="heatmap_bins" value="{{ heatmap_settings.bins }}" />
      </div>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <div id="dashboard-loading" class="htmx-indicator">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v3m0 12v3m9-9h-3M6 12H3m15.364-6.364l-2.121 2.121M8.757 15.243l-2.121 2.121m0-12.728l2.121 2.121m8.486 8.486l2.121 2.121" />
        </svg>
        <span>Refreshing…</span>
      </div>
      <div class="flex items-center gap-2 ml-auto">
        <button type="submit" class="btn">Apply</button>
        <a class="btn red" href="/">Reset</a>
      </div>
    </div>
  </form>

  <div class="flex flex-wrap gap-2 text-xs">
    <span class="muted">Filters:</span>
    {% if active_filters %}
      {% for f in active_filters %}
        <span class="chip">{{ f.label }}: {{ f.value }}</span>
      {% endfor %}
    {% else %}
      <span class="chip">Default view</span>
    {% endif %}
  </div>

  <section class="grid grid-cols-1 xl:grid-cols-3 gap-4" id="tactical-panels">
    <div class="space-y-4 xl:col-span-1" id="tactical-summary-column">
      <div class="card" id="tacticalSnapshot">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h2 class="text-lg font-semibold">Tactical Snapshot</h2>
            <div class="text-xs muted" id="tactical-baseline-label">No baseline selected.</div>
          </div>
          <button type="button" class="btn text-xs py-1 px-3" id="tactical-refresh-btn">Refresh</button>
        </div>
        <div class="mt-3 text-sm" id="tactical-snapshot-body">Select a baseline from the Control page to populate this view.</div>
      </div>
      <div class="card" id="bandSummaryCard">
        <div class="flex items-center justify-between gap-3">
          <h2 class="text-lg font-semibold">Band Summary (Active Baseline)</h2>
          <div class="text-xs muted" id="band-summary-meta">—</div>
        </div>
        <div class="mt-3 text-sm" id="band-summary-body">Select a baseline to build short band summaries.</div>
      </div>
    </div>
    <div class="card xl:col-span-2" id="activeSignalsCard">
      <div class="flex items-center justify-between gap-3">
        <h2 class="text-lg font-semibold">Current Active Signals</h2>
        <div class="text-xs muted" id="active-signals-meta">Window —</div>
      </div>
      <div class="mt-3 text-sm" id="active-signals-body">Signals seen in the last few minutes will show up here once a baseline is active.</div>
    </div>
  </section>

  <section class="card" id="hotspot-panel">
    <div class="flex items-center justify-between gap-3 mb-2">
      <h2 class="text-lg font-semibold">Hotspots</h2>
      <div class="text-xs muted" id="hotspot-meta">—</div>
    </div>
    <div id="hotspot-strip" class="hotspot-strip" role="presentation"></div>
    <div id="hotspot-empty" class="text-sm muted">Select a baseline to render occupancy.</div>
    <div id="hotspot-axis" class="flex justify-between text-[11px] text-slate-400 mt-2"></div>
  </section>
</div>
